function [ P, C ] = ply2mat( filePath )
% PLY2MAP( filePath )
%
% Converts '.ply' format file to 3D point cloud (x,y,z).
%
% INPUT
%
% filePath:     Path to the '.ply' file store
%
% OUTPUT
%
% pointCloud:	3D array of point cloud coordinates x,y,z (N x 3).
%               The point cloud can have additional columns for the
%               color information:
%               - Greyscale: N x 4 matrix with the additional column
%                 containing the grayscale value of the points (0-256).
%               - RGB: N x 6 with the last three columns containing the
%               red, green and blue values of the points (0-256).

% Giulio Marin
%
% giulio.marin@me.com
% 2014/03/15

%% Script

fid = fopen(path2ply,'r');

n = fscanf(fid, ['ply\n'...
    'format ascii 1.0\n'...
    'element vertex %d\n'...
    'property float x\n'...
    'property float y\n'...
    'property float z\n'...   
    'property uchar red\n'...
    'property uchar green\n'...
    'property uchar blue\n'...
    'end_header']);

P = zeros(n,3);
C = zeros(n,3);

for i=1:n
    [val,~] = fscanf(fid, '%f %f %f %d %d %d\n',6);
    P(i,1:3) = val(1:3,1);
    C(i,1:3) = val(4:6,1);
end

fclose(fid);

end

